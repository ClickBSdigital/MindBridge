<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MindBridge - Dashboard Profissional</title>
    <link rel="stylesheet" href="css/style.css">
    <style>
        .professional-header {
            background: var(--verde-esperanca);
            color: var(--branco);
        }
        
        .patient-card {
            border: 2px solid var(--cinza-claro);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

         .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .metric-card {
            background: var(--branco);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--azul-primario);
        }
        
        .patient-card:hover {
            border-color: var(--verde-esperanca);
            transform: translateY(-2px);
        }
        
        .patient-card.urgent {
            border-color: var(--vermelho-emergencia);
            background: rgba(220, 53, 69, 0.05);
        }
        
        .risk-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .risk-low { background: var(--verde-seguro); }
        .risk-medium { background: var(--laranja-atencao); }
        .risk-high { background: var(--vermelho-emergencia); }
        
        .schedule-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .schedule-slot {
            padding: 15px;
            border: 2px solid var(--cinza-claro);
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
        }
        
        .schedule-slot.available {
            border-color: var(--verde-seguro);
            background: rgba(40, 167, 69, 0.1);
        }
        
        .schedule-slot.booked {
            border-color: var(--azul-primario);
            background: rgba(74, 144, 226, 0.1);
        }
        
        .assessment-tools {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }
        
        .tool-btn {
            padding: 10px;
            border: 1px solid var(--azul-primario);
            border-radius: 8px;
            background: var(--branco);
            color: var(--azul-primario);
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .tool-btn:hover {
            background: var(--azul-primario);
            color: var(--branco);
        }
    </style>
</head>
<body>
    <div class="header professional-header">
        <div class="header-content">
            <div class="logo">MindBridge - Profissional</div>
            <div class="user-menu">
                <span>Dra. Ana Costa - CRP 12345/MS</span>
                <a href="index.html" class="btn btn-warning">Sair</a>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- RESUMO PROFISSIONAL -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-value">8</div>
                <div>Pacientes Hoje</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">3</div>
                <div>Encaminhamentos Pendentes</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">45min</div>
                <div>Pr√≥xima Disponibilidade</div>
            </div>
            <div class="metric-card">
                <div class="metric-value">12</div>
                <div>Relat√≥rios Pendentes</div>
            </div>
        </div>

        <!-- ENCAMINHAMENTOS URGENTES -->
        <div class="card">
            <h3>üö® Encaminhamentos Urgentes</h3>
            <div class="patient-card urgent" onclick="openPatientChart('patient1')">
                <div style="display: flex; justify-content: between; align-items: start;">
                    <div style="flex: 1;">
                        <strong>Jo√£o Silva - 28 anos</strong>
                        <div style="font-size: 14px; color: var(--cinza-medio);">
                            <span class="risk-indicator risk-high"></span>
                            Risco Suicida Alto ‚Ä¢ Encaminhado por: Carlos (Mediador)
                        </div>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <strong>Hist√≥rico:</strong> Idea√ßƒÅo suicida recorrente, hist√≥rico de depress√£o, isolamento social
                        </div>
                    </div>
                    <button class="btn btn-emergency" onclick="event.stopPropagation(); startEmergencySession('patient1', 'Jo√£o Silva', 'high')">
                        Atender Agora
                    </button>
                </div>
            </div>
            
            <div class="patient-card" onclick="openPatientChart('patient2')">
                <div style="display: flex; justify-content: between; align-items: start;">
                    <div style="flex: 1;">
                        <strong>Mariana Oliveira - 32 anos</strong>
                        <div style="font-size: 14px; color: var(--cinza-medio);">
                            <span class="risk-indicator risk-medium"></span>
                            Transtorno de Ansiedade ‚Ä¢ Encaminhado por: Maria (Mediador)
                        </div>
                        <div style="margin-top: 10px; font-size: 14px;">
                            <strong>Queixa principal:</strong> Crises de p√¢nico, ins√¥nia, dificuldade de concentra√ß√£o
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="event.stopPropagation(); scheduleSession('patient2', 'Mariana Oliveira')">
                        Agendar Sess√£o
                    </button>
                </div>
            </div>
        </div>

        <!-- AGENDA DO DIA -->
        <div class="card">
            <h3>üìÖ Agenda de Hoje</h3>
            <div class="schedule-grid">
                <div class="schedule-slot booked" onclick="openChatSession('pedro-santos', 'Pedro Santos')">
                    <strong>09:00 - 09:50</strong>
                    <div>Pedro Santos</div>
                    <div style="font-size: 12px; color: var(--cinza-medio);">Follow-up Depress√£o</div>
                </div>
                <div class="schedule-slot available">
                    <strong>10:00 - 10:50</strong>
                    <div>Dispon√≠vel</div>
                    <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;" onclick="blockScheduleSlot('10:00')">
                        Bloquear
                    </button>
                </div>
                <div class="schedule-slot booked" onclick="openChatSession('ana-beatriz', 'Ana Beatriz')">
                    <strong>11:00 - 11:50</strong>
                    <div>Ana Beatriz</div>
                    <div style="font-size: 12px; color: var(--cinza-medio);">Avalia√ß√£o Inicial</div>
                </div>
                <div class="schedule-slot booked" onclick="openChatSession('carlos-mendes', 'Carlos Mendes')">
                    <strong>14:00 - 14:50</strong>
                    <div>Carlos Mendes</div>
                    <div style="font-size: 12px; color: var(--cinza-medio);">TCC - Sess√£o 3</div>
                </div>
            </div>
        </div>

        <!-- FERRAMENTAS CL√çNICAS -->
        <div class="card">
            <h3>üõ†Ô∏è Ferramentas Cl√≠nicas</h3>
            <div class="assessment-tools">
                <div class="tool-btn" onclick="openAssessment('phq9')">PHQ-9</div>
                <div class="tool-btn" onclick="openAssessment('gad7')">GAD-7</div>
                <div class="tool-btn" onclick="openAssessment('bdi')">BDI</div>
                <div class="tool-btn" onclick="openAssessment('who5')">WHO-5</div>
                <div class="tool-btn" onclick="openAssessment('custom')">Avalia√ß√£o Customizada</div>
            </div>
            
            <div style="margin-top: 20px;">
                <a href="anotacoes-clinicas.html" class="btn btn-primary" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                    üìù Anota√ß√µes Cl√≠nicas
                </a>
                <a href="prescricoes.html" class="btn btn-primary" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                    üíä Prescri√ß√µes e Encaminhamentos
                </a>
                <a href="relatorio-clinico.html" class="btn btn-primary" style="text-decoration: none; display: inline-flex; align-items: center; gap: 5px;">
                    üìä Relat√≥rio Cl√≠nico
                </a>
            </div>
        </div>

        <!-- PR√ìXIMAS SESS√ïES -->
        <div class="card">
            <h3>‚è∞ Pr√≥ximas Sess√µes</h3>
            <div style="max-height: 300px; overflow-y: auto;">
                <div style="padding: 10px; border-bottom: 1px solid var(--cinza-claro); cursor: pointer;" onclick="openChatSession('joao-silva-tomorrow', 'Jo√£o Silva')">
                    <strong>Amanh√£ - 09:00</strong>
                    <div style="font-size: 14px; color: var(--cinza-medio);">
                        Jo√£o Silva ‚Ä¢ Avalia√ß√£o de risco
                    </div>
                </div>
                <div style="padding: 10px; border-bottom: 1px solid var(--cinza-claro); cursor: pointer;" onclick="openChatSession('mariana-oliveira-tomorrow', 'Mariana Oliveira')">
                    <strong>Amanh√£ - 14:00</strong>
                    <div style="font-size: 14px; color: var(--cinza-medio);">
                        Mariana Oliveira ‚Ä¢ Primeira sess√£o TCC
                    </div>
                </div>
                <div style="padding: 10px; border-bottom: 1px solid var(--cinza-claro); cursor: pointer;" onclick="openChatSession('carlos-mendes-followup', 'Carlos Mendes')">
                    <strong>05/12 - 10:00</strong>
                    <div style="font-size: 14px; color: var(--cinza-medio);">
                        Carlos Mendes ‚Ä¢ Follow-up medica√ß√£o
                    </div>
                </div>
            </div>
        </div>

        <!-- ESTAT√çSTICAS PROFISSIONAIS -->
        <div class="card">
            <h3>üìà Estat√≠sticas do M√™s</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; text-align: center;">
                <div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--verde-esperanca);">42</div>
                    <div style="font-size: 12px;">Sess√µes Realizadas</div>
                </div>
                <div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--azul-primario);">8</div>
                    <div style="font-size: 12px;">Novos Pacientes</div>
                </div>
                <div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--laranja-atencao);">92%</div>
                    <div style="font-size: 12px;">Taxa de Comparecimento</div>
                </div>
                <div>
                    <div style="font-size: 18px; font-weight: bold; color: var(--vermelho-emergencia);">3</div>
                    <div style="font-size: 12px;">Interven√ß√µes de Crise</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function openPatientChart(patientId) {
            // Redirecionar para a p√°gina de prontu√°rio do paciente
            // Em produ√ß√£o, esta fun√ß√£o abriria o prontu√°rio completo
            alert(`Abrindo prontu√°rio do paciente ${getPatientName(patientId)}\n\nEm produ√ß√£o, esta p√°gina mostraria:\n‚Ä¢ Hist√≥rico completo\n‚Ä¢ Anota√ß√µes cl√≠nicas\n‚Ä¢ Evolu√ß√£o do tratamento\n‚Ä¢ Prescri√ß√µes\n‚Ä¢ Relat√≥rios`);
        }
        
        function startEmergencySession(patientId, patientName, riskLevel) {
            // Iniciar sess√£o de emerg√™ncia direto no chat
            if (confirm(`Iniciar sess√£o de emerg√™ncia com ${patientName}?\nRisco: ${riskLevel === 'high' ? 'ALTO' : 'M√âDIO'}\n\nO paciente ser√° direcionado para a sala de chat.`)) {
                // Redirecionar para o chat.html com par√¢metros espec√≠ficos
                window.location.href = `chat.html?user=profissional&patient=${patientId}&name=${encodeURIComponent(patientName)}&emergency=true&risk=${riskLevel}&role=professional`;
            }
        }
        
        function openChatSession(patientId, patientName) {
            // Abrir sess√£o de chat regular
            if (confirm(`Iniciar sess√£o de chat com ${patientName}?`)) {
                window.location.href = `chat.html?user=profissional&patient=${patientId}&name=${encodeURIComponent(patientName)}&role=professional`;
            }
        }
        
        function scheduleSession(patientId, patientName) {
            // Abrir modal de agendamento
            const date = prompt(`Agendar sess√£o para ${patientName}\nDigite a data (DD/MM/AAAA):`);
            if (!date) return;
            
            const time = prompt('Digite o hor√°rio (HH:MM):');
            if (!time) return;
            
            if (date && time) {
                alert(`‚úÖ Sess√£o agendada para ${patientName}\nüìÖ ${date} √†s ${time}`);
                
                // Adicionar √† lista de pr√≥ximas sess√µes
                const nextSessions = document.querySelector('.card:nth-last-child(2)');
                if (nextSessions) {
                    const sessionDiv = document.createElement('div');
                    sessionDiv.style.padding = '10px';
                    sessionDiv.style.borderBottom = '1px solid var(--cinza-claro)';
                    sessionDiv.style.cursor = 'pointer';
                    sessionDiv.onclick = () => openChatSession(patientId.toLowerCase().replace(' ', '-'), patientName);
                    sessionDiv.innerHTML = `
                        <strong>${date} - ${time}</strong>
                        <div style="font-size: 14px; color: var(--cinza-medio);">
                            ${patientName} ‚Ä¢ Sess√£o agendada
                        </div>
                    `;
                    nextSessions.querySelector('div').prepend(sessionDiv);
                }
            }
        }
        
        function getPatientName(patientId) {
            const patients = {
                'patient1': 'Jo√£o Silva',
                'patient2': 'Mariana Oliveira',
                'pedro-santos': 'Pedro Santos',
                'ana-beatriz': 'Ana Beatriz',
                'carlos-mendes': 'Carlos Mendes'
            };
            return patients[patientId] || 'Paciente';
        }
        
        function blockScheduleSlot(timeSlot) {
            if (confirm(`Bloquear hor√°rio ${timeSlot}?`)) {
                const slots = document.querySelectorAll('.schedule-slot.available');
                let targetSlot = null;
                
                slots.forEach(slot => {
                    if (slot.querySelector('strong').textContent.includes(timeSlot)) {
                        targetSlot = slot;
                    }
                });
                
                if (targetSlot) {
                    targetSlot.classList.remove('available');
                    targetSlot.classList.add('booked');
                    targetSlot.innerHTML = `
                        <strong>${timeSlot}</strong>
                        <div>Bloqueado</div>
                        <div style="font-size: 12px; color: var(--cinza-medio);">Manuten√ß√£o/Reuni√£o</div>
                        <button class="btn btn-secondary" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;" onclick="unblockScheduleSlot('${timeSlot}')">
                            Desbloquear
                        </button>
                    `;
                    targetSlot.onclick = null; // Remove o clique para abrir chat
                }
            }
        }
        
        function unblockScheduleSlot(timeSlot) {
            if (confirm(`Desbloquear hor√°rio ${timeSlot}?`)) {
                const slots = document.querySelectorAll('.schedule-slot.booked');
                let targetSlot = null;
                
                slots.forEach(slot => {
                    if (slot.querySelector('strong').textContent.includes(timeSlot)) {
                        targetSlot = slot;
                    }
                });
                
                if (targetSlot) {
                    targetSlot.classList.remove('booked');
                    targetSlot.classList.add('available');
                    targetSlot.innerHTML = `
                        <strong>${timeSlot}</strong>
                        <div>Dispon√≠vel</div>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 12px; margin-top: 5px;" onclick="blockScheduleSlot('${timeSlot}')">
                            Bloquear
                        </button>
                    `;
                    // N√£o adiciona onclick pois √© um slot dispon√≠vel
                }
            }
        }
        
        function openAssessment(tool) {
            // Abrir ferramentas de avalia√ß√£o em modal
            const toolNames = {
                'phq9': 'PHQ-9 (Patient Health Questionnaire)',
                'gad7': 'GAD-7 (Generalized Anxiety Disorder)',
                'bdi': 'BDI (Beck Depression Inventory)',
                'who5': 'WHO-5 (Well-Being Index)',
                'custom': 'Avalia√ß√£o Customizada'
            };
            
            const toolDescription = {
                'phq9': 'Avalia√ß√£o de sintomas depressivos com 9 quest√µes.',
                'gad7': 'Avalia√ß√£o de sintomas de ansiedade generalizada.',
                'bdi': 'Invent√°rio de depress√£o de Beck - vers√£o completa.',
                'who5': '√çndice de bem-estar da Organiza√ß√£o Mundial da Sa√∫de.',
                'custom': 'Crie sua pr√≥pria avalia√ß√£o personalizada.'
            };
            
            // Criar modal din√¢mico
            const modal = document.createElement('div');
            modal.style.position = 'fixed';
            modal.style.zIndex = '1000';
            modal.style.left = '0';
            modal.style.top = '0';
            modal.style.width = '100%';
            modal.style.height = '100%';
            modal.style.backgroundColor = 'rgba(0,0,0,0.8)';
            modal.style.display = 'flex';
            modal.style.alignItems = 'center';
            modal.style.justifyContent = 'center';
            
            modal.innerHTML = `
                <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h3 style="margin: 0; color: var(--azul-profissional);">${toolNames[tool]}</h3>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" style="background: none; border: none; font-size: 24px; cursor: pointer; color: var(--cinza-medio);">&times;</button>
                    </div>
                    <p>${toolDescription[tool]}</p>
                    <div style="margin-top: 20px; padding: 15px; background: var(--cinza-claro); border-radius: 8px;">
                        <strong>Em um ambiente real:</strong>
                        <ul style="margin: 10px 0 10px 20px;">
                            <li>Question√°rio completo seria exibido</li>
                            <li>Possibilidade de aplica√ß√£o ao paciente</li>
                            <li>An√°lise autom√°tica de resultados</li>
                            <li>Armazenamento no prontu√°rio</li>
                        </ul>
                    </div>
                    <div style="margin-top: 25px; display: flex; justify-content: flex-end; gap: 10px;">
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">Fechar</button>
                        <button class="btn btn-primary" onclick="startAssessment('${tool}')">Iniciar Avalia√ß√£o</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function startAssessment(tool) {
            alert(`Iniciando avalia√ß√£o: ${tool}\n\nNo prot√≥tipo, esta funcionalidade abriria o question√°rio completo.\n\nPara testar com um paciente, voc√™ pode:\n1. Iniciar uma sess√£o de chat\n2. Enviar o link da avalia√ß√£o\n3. Analisar os resultados juntos`);
            // Fechar modal
            document.querySelector('div[style*="position: fixed"][style*="background: rgba(0,0,0,0.8)"]')?.remove();
        }
        
        function openClinicalNotes() {
            window.location.href = "anotacoes-clinicas.html";
        }
        
        function openPrescriptions() {
            window.location.href = "prescricoes.html";
        }
        
        function generateClinicalReport() {
            window.location.href = "relatorio-clinico.html";
        }
        
        // Simular notifica√ß√µes e atualiza√ß√µes em tempo real
        let patientCount = 8;
        let pendingReferrals = 3;
        
        function updateMetrics() {
            // Atualizar m√©tricas periodicamente
            patientCount += Math.floor(Math.random() * 2) - 1;
            patientCount = Math.max(5, Math.min(12, patientCount));
            
            pendingReferrals += Math.floor(Math.random() * 2) - 1;
            pendingReferrals = Math.max(1, Math.min(6, pendingReferrals));
            
            // Atualizar valores na interface
            const metricValues = document.querySelectorAll('.metric-value');
            if (metricValues.length >= 4) {
                metricValues[0].textContent = patientCount;
                metricValues[1].textContent = pendingReferrals;
                
                // Atualizar tempo de disponibilidade
                const nextAvailability = Math.floor(Math.random() * 90) + 15;
                metricValues[2].textContent = `${nextAvailability}min`;
            }
        }
        
        // Notifica√ß√£o de novo encaminhamento (simula√ß√£o)
        let notificationCount = 0;
        
        function showNewReferralNotification() {
            notificationCount++;
            if (notificationCount <= 2) { // Limitar a 2 notifica√ß√µes
                setTimeout(() => {
                    if(confirm(`Novo encaminhamento urgente recebido! Deseja visualizar?`)) {
                        // Criar novo card de paciente
                        const referralsContainer = document.querySelector('.card:nth-child(2)');
                        if (referralsContainer) {
                            const newPatient = document.createElement('div');
                            newPatient.className = 'patient-card urgent';
                            newPatient.style.animation = 'pulse 1s';
                            const newPatientId = `newPatient${notificationCount}`;
                            const newPatientName = notificationCount === 1 ? 'Roberto Alves' : 'Fernanda Costa';
                            
                            newPatient.innerHTML = `
                                <div style="display: flex; justify-content: between; align-items: start;">
                                    <div style="flex: 1;">
                                        <strong>${newPatientName} - ${notificationCount === 1 ? '35 anos' : '25 anos'}</strong>
                                        <div style="font-size: 14px; color: var(--cinza-medio);">
                                            <span class="risk-indicator risk-${notificationCount === 1 ? 'high' : 'medium'}"></span>
                                            ${notificationCount === 1 ? 'Crise de P√¢nico' : 'Depress√£o Moderada'} ‚Ä¢ Encaminhado agora
                                        </div>
                                        <div style="margin-top: 10px; font-size: 14px;">
                                            <strong>Queixa:</strong> ${notificationCount === 1 ? 'M√∫ltiplas crises de p√¢nico di√°rias' : 'Humor deprimido persistente h√° 3 meses'}
                                        </div>
                                    </div>
                                    <button class="btn btn-emergency" onclick="event.stopPropagation(); startEmergencySession('${newPatientId}', '${newPatientName}', '${notificationCount === 1 ? 'high' : 'medium'}')">
                                        Atender Agora
                                    </button>
                                </div>
                            `;
                            newPatient.onclick = () => openPatientChart(newPatientId);
                            referralsContainer.appendChild(newPatient);
                        }
                    }
                }, Math.random() * 20000 + 10000); // Entre 10-30 segundos
            }
        }
        
        // Inicializar
        document.addEventListener('DOMContentLoaded', function() {
            // Atualizar m√©tricas a cada 30 segundos
            setInterval(updateMetrics, 30000);
            
            // Mostrar notifica√ß√µes simuladas
            setTimeout(showNewReferralNotification, 5000);
            setTimeout(showNewReferralNotification, 20000);
            
            // Adicionar estilo de anima√ß√£o para novos itens
            const style = document.createElement('style');
            style.textContent = `
                @keyframes pulse {
                    0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
                    70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
                    100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
                }
                .btn-emergency {
                    background: var(--vermelho-emergencia) !important;
                    color: white !important;
                    border: none !important;
                    padding: 8px 16px !important;
                    border-radius: 6px !important;
                    cursor: pointer !important;
                    font-weight: bold !important;
                    white-space: nowrap !important;
                }
                .btn-emergency:hover {
                    background: #c82333 !important;
                }
            `;
            document.head.appendChild(style);
            
            // Adicionar evento de clique em todos os slots de agenda
            document.querySelectorAll('.schedule-slot.booked').forEach(slot => {
                const patientName = slot.querySelector('div:nth-child(2)').textContent;
                const patientId = patientName.toLowerCase().replace(' ', '-');
                slot.onclick = () => openChatSession(patientId, patientName);
            });
        });
    </script>
</body>
</html>